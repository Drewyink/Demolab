<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Facets ‚Äî Claims</title>
  <link rel="stylesheet" href="styles.css">
</head>
<body>
<div class="app-layout">
  <aside class="sidebar">
    <div class="sidebar-logo">
      <div class="logo-icon">FX</div>
      <div><div class="logo-text">FACETS</div><div class="logo-sub">Config Suite</div></div>
    </div>
    <nav class="sidebar-nav">
      <div class="nav-section-label">Overview</div>
      <a class="nav-item" href="index.html"><span class="nav-icon">‚óà</span> Dashboard</a>
      <div class="nav-section-label">Configuration</div>
      <a class="nav-item" href="members.html"><span class="nav-icon">üë§</span> Members</a>
      <a class="nav-item" href="products.html"><span class="nav-icon">üì¶</span> Products</a>
      <a class="nav-item" href="plans.html"><span class="nav-icon">üìã</span> Plans</a>
      <a class="nav-item" href="benefits.html"><span class="nav-icon">‚úö</span> Benefits</a>
      <a class="nav-item" href="pricing.html"><span class="nav-icon">üí≤</span> Pricing</a>
      <div class="nav-section-label">Operations</div>
      <a class="nav-item" href="claims.html"><span class="nav-icon">üìÑ</span> Claims</a>
      <a class="nav-item" href="audit.html"><span class="nav-icon">üîç</span> Audit Log</a>
    </nav>
    <div class="sidebar-footer"><div class="env-badge">Sandbox ¬∑ v1.0</div></div>
  </aside>
  <main class="main-content">
    <div class="topbar">
      <div class="topbar-left"><span class="topbar-breadcrumb">Operations ‚Üí <span>Claims</span></span></div>
      <div class="topbar-right"><span class="topbar-clock" id="clock"></span></div>
    </div>
    <div class="page-content">
      <div class="page-header">
        <div>
          <div class="page-title">Claims Processing</div>
          <div class="page-subtitle">SUBMIT ¬∑ REVIEW ¬∑ ADJUDICATE</div>
        </div>
        <button class="btn btn-primary" onclick="openModal()">+ New Claim</button>
      </div>
      <div class="stats-grid" style="grid-template-columns:repeat(4,1fr);margin-bottom:20px">
        <div class="stat-card yellow"><div class="stat-label">Total Billed</div><div class="stat-value" id="s-billed" style="font-size:18px">‚Äî</div></div>
        <div class="stat-card green"><div class="stat-label">Total Paid</div><div class="stat-value" id="s-paid" style="font-size:18px">‚Äî</div></div>
        <div class="stat-card orange"><div class="stat-label">Pending</div><div class="stat-value" id="s-pending">‚Äî</div></div>
        <div class="stat-card red"><div class="stat-label">Denied</div><div class="stat-value" id="s-denied">‚Äî</div></div>
      </div>
      <div class="card">
        <div class="card-header">
          <span class="card-title">üìÑ Claims <span class="count-label" id="count"></span></span>
          <div style="display:flex;gap:10px;align-items:center">
            <div class="filter-tabs">
              <button class="filter-tab active" onclick="filterStatus('all',this)">All</button>
              <button class="filter-tab" onclick="filterStatus('pending',this)">Pending</button>
              <button class="filter-tab" onclick="filterStatus('paid',this)">Paid</button>
              <button class="filter-tab" onclick="filterStatus('denied',this)">Denied</button>
            </div>
            <div class="search-bar" style="margin:0;width:200px">
              <span class="search-icon">üîé</span>
              <input type="text" placeholder="Search claims..." id="search-input">
            </div>
          </div>
        </div>
        <div class="table-wrapper">
          <table>
            <thead><tr>
              <th>Claim #</th><th>Provider</th><th>Service Date</th><th>DX Code</th><th>Proc Code</th><th>Billed</th><th>Allowed</th><th>Paid</th><th>Status</th><th>Actions</th>
            </tr></thead>
            <tbody id="tbody"></tbody>
          </table>
        </div>
      </div>
    </div>
  </main>
</div>
<div class="modal-overlay" id="modal">
  <div class="modal" style="width:680px">
    <div class="modal-header">
      <span class="modal-title" id="modal-title">New Claim</span>
      <button class="modal-close" onclick="closeModal()">‚úï</button>
    </div>
    <div class="modal-body">
      <form class="form-grid">
        <input type="hidden" id="f-id">
        <div class="form-group">
          <label class="form-label">Claim Number</label>
          <input type="text" class="form-input" id="f-claim_number" required>
        </div>
        <div class="form-group">
          <label class="form-label">Status</label>
          <select class="form-select" id="f-status">
            <option value="pending">Pending</option>
            <option value="paid">Paid</option>
            <option value="denied">Denied</option>
            <option value="void">Void</option>
            <option value="in_review">In Review</option>
          </select>
        </div>
        <div class="form-group full">
          <label class="form-label">Provider</label>
          <input type="text" class="form-input" id="f-provider" required>
        </div>
        <div class="form-group">
          <label class="form-label">Service Date</label>
          <input type="date" class="form-input" id="f-service_date" required>
        </div>
        <div class="form-group">
          <label class="form-label">Claim Date</label>
          <input type="date" class="form-input" id="f-claim_date">
        </div>
        <div class="form-group">
          <label class="form-label">Diagnosis Code (ICD-10)</label>
          <input type="text" class="form-input" id="f-diagnosis_code" placeholder="Z00.00">
        </div>
        <div class="form-group">
          <label class="form-label">Procedure Code (CPT)</label>
          <input type="text" class="form-input" id="f-procedure_code" placeholder="99213">
        </div>
        <div class="form-group">
          <label class="form-label">Billed Amount ($)</label>
          <input type="number" class="form-input" id="f-billed_amount" step="0.01" min="0">
        </div>
        <div class="form-group">
          <label class="form-label">Allowed Amount ($)</label>
          <input type="number" class="form-input" id="f-allowed_amount" step="0.01" min="0">
        </div>
        <div class="form-group">
          <label class="form-label">Paid Amount ($)</label>
          <input type="number" class="form-input" id="f-paid_amount" step="0.01" min="0">
        </div>
        <div class="form-group full">
          <label class="form-label">Notes</label>
          <textarea class="form-textarea" id="f-notes"></textarea>
        </div>
      </form>
    </div>
    <div class="modal-footer">
      <button class="btn btn-secondary" onclick="closeModal()">Cancel</button>
      <button class="btn btn-primary" onclick="save()">Save Claim</button>
    </div>
  </div>
</div>
<script src="app.js"></script>
<script>
let records = [];
let statusFilter = 'all';

async function load() {
  records = await apiFetch('/api/claims');
  updateSummary();
  render();
}

function updateSummary() {
  const billed = records.reduce((s,r)=>s+parseFloat(r.billed_amount||0),0);
  const paid = records.reduce((s,r)=>s+parseFloat(r.paid_amount||0),0);
  document.getElementById('s-billed').textContent = currency(billed);
  document.getElementById('s-paid').textContent = currency(paid);
  document.getElementById('s-pending').textContent = records.filter(r=>r.status==='pending').length;
  document.getElementById('s-denied').textContent = records.filter(r=>r.status==='denied').length;
}

function filterStatus(s, btn) {
  statusFilter = s;
  document.querySelectorAll('.filter-tab').forEach(b=>b.classList.remove('active'));
  btn.classList.add('active');
  render();
}

function render() {
  const q = document.getElementById('search-input').value.toLowerCase();
  let data = statusFilter !== 'all' ? records.filter(r=>r.status===statusFilter) : records;
  if (q) data = data.filter(r=>JSON.stringify(r).toLowerCase().includes(q));
  document.getElementById('count').textContent = `¬∑ ${data.length} records`;
  const tbody = document.getElementById('tbody');
  if (!data.length) { tbody.innerHTML = `<tr><td colspan="10"><div class="empty-state"><div class="empty-icon">üìÑ</div><p>No claims found</p></div></td></tr>`; return; }
  tbody.innerHTML = data.map(r => `
    <tr>
      <td class="mono" style="color:var(--accent)">${r.claim_number}</td>
      <td>${r.provider || '‚Äî'}</td>
      <td class="mono" style="font-size:11px">${fmtDate(r.service_date)}</td>
      <td class="mono">${r.diagnosis_code || '‚Äî'}</td>
      <td class="mono">${r.procedure_code || '‚Äî'}</td>
      <td class="mono amount-billed">${currency(r.billed_amount)}</td>
      <td class="mono amount-allowed">${currency(r.allowed_amount)}</td>
      <td class="mono amount-paid">${currency(r.paid_amount)}</td>
      <td>${badge(r.status, r.status)}</td>
      <td><div class="actions">
        <button class="btn btn-sm btn-secondary" onclick="edit('${r.id}')">Edit</button>
        <button class="btn btn-sm btn-danger" onclick="del('${r.id}')">Del</button>
      </div></td>
    </tr>`).join('');
}

function openModal(data = null) {
  document.getElementById('modal-title').textContent = data ? 'Edit Claim' : 'New Claim';
  const today = new Date().toISOString().split('T')[0];
  document.getElementById('f-id').value = data?.id || '';
  document.getElementById('f-claim_number').value = data?.claim_number || `CLM-${new Date().getFullYear()}-${String(Math.floor(Math.random()*9000+1000))}`;
  document.getElementById('f-status').value = data?.status || 'pending';
  document.getElementById('f-provider').value = data?.provider || '';
  document.getElementById('f-service_date').value = data?.service_date?.split('T')[0] || today;
  document.getElementById('f-claim_date').value = data?.claim_date?.split('T')[0] || today;
  document.getElementById('f-diagnosis_code').value = data?.diagnosis_code || '';
  document.getElementById('f-procedure_code').value = data?.procedure_code || '';
  document.getElementById('f-billed_amount').value = data?.billed_amount || '';
  document.getElementById('f-allowed_amount').value = data?.allowed_amount || '';
  document.getElementById('f-paid_amount').value = data?.paid_amount || '';
  document.getElementById('f-notes').value = data?.notes || '';
  document.getElementById('modal').classList.add('open');
}
function closeModal() { document.getElementById('modal').classList.remove('open'); }
function edit(id) { openModal(records.find(r=>r.id===id)); }

async function save() {
  const id = document.getElementById('f-id').value;
  const body = {
    claim_number: document.getElementById('f-claim_number').value,
    status: document.getElementById('f-status').value,
    provider: document.getElementById('f-provider').value,
    service_date: document.getElementById('f-service_date').value,
    claim_date: document.getElementById('f-claim_date').value,
    diagnosis_code: document.getElementById('f-diagnosis_code').value,
    procedure_code: document.getElementById('f-procedure_code').value,
    billed_amount: document.getElementById('f-billed_amount').value,
    allowed_amount: document.getElementById('f-allowed_amount').value,
    paid_amount: document.getElementById('f-paid_amount').value,
    notes: document.getElementById('f-notes').value
  };
  if (id) { await apiFetch(`/api/claims/${id}`, { method: 'PUT', body: JSON.stringify(body) }); toast('Claim updated', 'success'); }
  else { await apiFetch('/api/claims', { method: 'POST', body: JSON.stringify(body) }); toast('Claim created', 'success'); }
  closeModal(); load();
}

async function del(id) {
  if (!await confirmDialog('Delete this claim?')) return;
  await apiFetch(`/api/claims/${id}`, { method: 'DELETE' });
  toast('Claim deleted', 'info'); load();
}

document.getElementById('search-input').addEventListener('input', render);
load();
</script>
</body>
</html>
